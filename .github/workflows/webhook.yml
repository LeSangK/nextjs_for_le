name: Notify Release

on:
  release:
    types: [published]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - id: get_release_note
        name: echo release note
        run: |
          # 改行コードをエスケープする
          release_body='${{ github.event.release.body }}'
          release_body=${release_body//$'\r\n'/\\n}
          release_body=${release_body//$'\n'/\\n}
          echo "::set-output name=body::$release_body"

      - name: Send notification
        run: |
          curl -X POST --data-urlencode "payload={\"channel\": \"#timeline_raku\", \"username\": \"test raku pull request\", \"text\": \"${{ steps.get_release_note.outputs.body }} \", \"icon_emoji\": \":kabigon:\"}" ${{ secrets.SLACK_WEBHOOK_URL }}
